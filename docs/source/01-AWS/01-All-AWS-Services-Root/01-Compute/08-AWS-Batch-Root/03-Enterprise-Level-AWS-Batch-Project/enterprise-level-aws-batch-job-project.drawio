<mxfile host="Electron" modified="2023-06-08T00:39:00.488Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.2.8 Chrome/112.0.5615.165 Electron/24.2.0 Safari/537.36" etag="2VFvVc4rSrGNTGFHUxSo" version="21.2.8" type="device" pages="2">
  <diagram name="Legend" id="z6jSzgCiW5RnPUVdufkl">
    <mxGraphModel dx="1172" dy="864" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="68i_17OurAIHHucpONj3-1" value="ECR Repository&lt;br&gt;(Repo)" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" parent="1" vertex="1">
          <mxGeometry x="320" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="CfmIEOWS_kzRGeqCO8xf-1" value="Computer Environment (CE)" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.fargate;" parent="1" vertex="1">
          <mxGeometry x="80" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="CfmIEOWS_kzRGeqCO8xf-2" value="Job Queue (JQ)" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.queue;fillColor=#D9A741;gradientColor=none;" parent="1" vertex="1">
          <mxGeometry x="200" y="260" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="CfmIEOWS_kzRGeqCO8xf-3" value="Job Definition (JD)" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.template;" parent="1" vertex="1">
          <mxGeometry x="440" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="CfmIEOWS_kzRGeqCO8xf-4" value="Job" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="560" y="240" width="80" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="293qNDeWv0qaT0oo8n8v" name="Solution">
    <mxGraphModel dx="1953" dy="2540" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="MU77rL3NTsPCpgWwWrD0-6" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="40" y="80" width="640" height="320" as="geometry" />
        </mxCell>
        <mxCell id="p0UqRTTcLk-lKmNQq-99-6" value="&lt;h1&gt;一个极简的 AWS Batch Project&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;div&gt;一个极简的 AWS Batch 项目至少包含了了以下资源. 而一个公司可能有非常多个这样的项目. 这些资源里有些适合跟着每个项目单独部署, 有些适合统一管理, 本 Solution 给出了一个经过时间考验的最优解.&lt;/div&gt;&lt;ul&gt;&lt;li&gt;一个 Computer Environment (CE), 定义了网络, Subnet, Security Group, 最大算力.&lt;/li&gt;&lt;li&gt;一个 Job Queue (JQ), 用来给 Job 排序.&lt;/li&gt;&lt;li&gt;一个 ECR Repo 用来保存你的镜像.&lt;/li&gt;&lt;li&gt;一个 Job Definition (JD), 里面定义了使用你的 container image 来计算的细节, 包括 CPU, Memory, Command, Parameter, Environment Variables 等等.&lt;/li&gt;&lt;li&gt;将 JD Submit 到 JQ 中, 然后交给 CE 来运行, 就成为了一个具体的 Job&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=default;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="MU77rL3NTsPCpgWwWrD0-6" vertex="1">
          <mxGeometry width="640" height="320" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-1" value="ECR Repository&lt;br&gt;(Repo)" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" parent="MU77rL3NTsPCpgWwWrD0-6" vertex="1">
          <mxGeometry x="280" y="200" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-2" value="Computer Environment (CE)" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.fargate;" parent="MU77rL3NTsPCpgWwWrD0-6" vertex="1">
          <mxGeometry x="40" y="200" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-3" value="Job Queue (JQ)" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.queue;fillColor=#D9A741;gradientColor=none;" parent="MU77rL3NTsPCpgWwWrD0-6" vertex="1">
          <mxGeometry x="160" y="220" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-4" value="Job Definition (JD)" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.template;" parent="MU77rL3NTsPCpgWwWrD0-6" vertex="1">
          <mxGeometry x="400" y="200" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-5" value="Job" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="MU77rL3NTsPCpgWwWrD0-6" vertex="1">
          <mxGeometry x="520" y="200" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-7" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="40" y="-20" width="800" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-44" value="&lt;h1&gt;AWS Batch and ECR Service Quota&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;div&gt;下面列出了 AWS Batch 和 ECR 的限制. 可以看出来 Job Queue 和 Compute Environment 的上限是比较低的. 在企业中一个 AWS Account 一个 Region 下有几百个 Deployment Units 非常常见. 我们不太可能为每一个 Deployment Units 创建一个 JQ 和 CE. 另外, 从业务逻辑的角度看, JQ 和 CE 更像是一个大型的算力池, 让许多个 Batch Job 复用这个大型的算力池是更加符合直觉. 所以我比较推荐用 1 个 CloudFormation Stack 来维护该 Region 下所有的 JQ 和 CE.&lt;/div&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;Maximum number of job queues. 50&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;Maximum number of compute environments. 50&lt;/b&gt;&lt;/li&gt;&lt;li&gt;Maximum number of compute environments for each job queue.&lt;span style=&quot;background-color: initial;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;3&lt;/span&gt;&lt;/li&gt;&lt;li&gt;Maximum number of job dependencies for a job. 20&lt;/li&gt;&lt;li&gt;Maximum job definition size (for RegisterJobDefinition API operations). 24 KiB&lt;/li&gt;&lt;li&gt;Maximum job payload size (for SubmitJob API operations). 30 KiB&lt;/li&gt;&lt;li&gt;Maximum array size for array jobs. 10000&lt;/li&gt;&lt;li&gt;Maximum number of jobs in SUBMITTED state. 1000000&lt;/li&gt;&lt;li&gt;Maximum number of transactions per second (TPS) for each account for SubmitJob operations. 50&lt;/li&gt;&lt;li&gt;&lt;b&gt;Images per repository. 10000&lt;/b&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;Registered repositories. 10000&lt;/b&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;Reference:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/batch/latest/userguide/service_limits.html&quot;&gt;AWS Batch Quota&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/AmazonECR/latest/userguide/service-quotas.html&quot;&gt;AWS ECR Quota&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=default;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="520" width="560" height="400" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-7" value="&lt;h1&gt;Per Job Stack&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;div&gt;前面我们说了 JQ 和 CE 应该单独维护. 那么剩下的 ECR Repository, Job Definition, Batch job execution role, Container Image 应该怎么做比较好?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;因为这些资源的 Quota 都比较高, 所以具体做法要视具体情况而定. 其中 IAM Role, Container Image, Job Definition 由于跟业务高度相关, 所以它们比较适合放在一个 Deployment Unit 里. 而 ECR Repo 则既可以放在所属的 App 的 Deployment Unit 里, 也可以由管理员统一管理. 我个人比较推荐放在 Deployment Unit 管理, 由 App 所属的项目组自己管, 它们自己定 Life Cycle Policy, Tagging 等. 但是也有的公司对容器安全超级重视, 要求所有的容器镜像都要统一进行安全漏洞扫描. 那这种情况下就交给专门的项目组来管理比较好.&lt;/div&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=default;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="1040" width="560" height="200" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-37" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="40" y="1360" width="1120" height="840" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-4" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-37" vertex="1" connectable="0">
          <mxGeometry x="560" width="560" height="840" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-16" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-4" vertex="1" connectable="0">
          <mxGeometry x="280" y="80" width="240" height="720" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-14" value="Compute Environment (CE)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;verticalAlign=top;container=0;" parent="MU77rL3NTsPCpgWwWrD0-16" vertex="1">
          <mxGeometry width="240" height="720" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-8" value="CE1&lt;br&gt;Fargate" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.fargate;container=0;" parent="MU77rL3NTsPCpgWwWrD0-16" vertex="1">
          <mxGeometry x="80" y="80" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-9" value="CE2&lt;br&gt;Fargate Spot" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.fargate;container=0;" parent="MU77rL3NTsPCpgWwWrD0-16" vertex="1">
          <mxGeometry x="80" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-28" value="" style="pointerEvents=1;shadow=0;dashed=0;html=1;strokeColor=none;fillColor=#f78e04;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;align=center;outlineConnect=0;shape=mxgraph.veeam.cpu;" parent="MU77rL3NTsPCpgWwWrD0-16" vertex="1">
          <mxGeometry width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-26" value="CE3&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;EC2" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ec2;" parent="MU77rL3NTsPCpgWwWrD0-16" vertex="1">
          <mxGeometry x="80" y="400" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-27" value="CE4&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;EC2 Spot" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ec2;" parent="MU77rL3NTsPCpgWwWrD0-16" vertex="1">
          <mxGeometry x="80" y="560" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-25" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-4" vertex="1" connectable="0">
          <mxGeometry x="40" y="80" width="160" height="720" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-23" value="Job Queue (JQ)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;verticalAlign=top;" parent="MU77rL3NTsPCpgWwWrD0-25" vertex="1">
          <mxGeometry width="160" height="720" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-17" value="Critical" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.queue;fillColor=#e51400;fontColor=#000000;strokeColor=#B20000;" parent="MU77rL3NTsPCpgWwWrD0-25" vertex="1">
          <mxGeometry x="40" y="100" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-18" value="High Priority" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.queue;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="MU77rL3NTsPCpgWwWrD0-25" vertex="1">
          <mxGeometry x="40" y="260" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-19" value="&lt;font color=&quot;#000000&quot;&gt;Regular&lt;/font&gt;" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.queue;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="MU77rL3NTsPCpgWwWrD0-25" vertex="1">
          <mxGeometry x="40" y="420" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-20" value="&lt;font color=&quot;#000000&quot;&gt;Low Priority&lt;/font&gt;" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.queue;fillColor=#647687;fontColor=#ffffff;strokeColor=#314354;" parent="MU77rL3NTsPCpgWwWrD0-25" vertex="1">
          <mxGeometry x="40" y="580" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-1" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F34482;gradientDirection=north;fillColor=#BC1356;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudformation;" parent="YPGgIuon6uP2eLTShOE7-4" vertex="1">
          <mxGeometry width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-3" value="CloudFormation Stack" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;verticalAlign=top;" parent="YPGgIuon6uP2eLTShOE7-4" vertex="1">
          <mxGeometry width="560" height="840" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-12" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-37" vertex="1" connectable="0">
          <mxGeometry width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="MU77rL3NTsPCpgWwWrD0-29" value="Job Definition&lt;br&gt;1, 2, 3, ..." style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.template;" parent="YPGgIuon6uP2eLTShOE7-12" vertex="1">
          <mxGeometry x="400" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-5" value="IAM Role" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#BF0816;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.role;" parent="YPGgIuon6uP2eLTShOE7-12" vertex="1">
          <mxGeometry x="40" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-6" value="Repo 1" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" parent="YPGgIuon6uP2eLTShOE7-12" vertex="1">
          <mxGeometry x="160" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-10" value="Container Image&lt;br&gt;Tag1, 2, 3, ..." style="html=1;verticalLabelPosition=bottom;align=center;labelBackgroundColor=#ffffff;verticalAlign=top;strokeWidth=2;strokeColor=#0080F0;shadow=0;dashed=0;shape=mxgraph.ios7.icons.cube;" parent="YPGgIuon6uP2eLTShOE7-12" vertex="1">
          <mxGeometry x="280" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-11" value="App 1" style="swimlane;whiteSpace=wrap;html=1;" parent="YPGgIuon6uP2eLTShOE7-12" vertex="1">
          <mxGeometry width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-13" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-37" vertex="1" connectable="0">
          <mxGeometry y="240" width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-14" value="Job Definition&lt;br&gt;1, 2, 3, ..." style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.template;" parent="YPGgIuon6uP2eLTShOE7-13" vertex="1">
          <mxGeometry x="400" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-15" value="IAM Role" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#BF0816;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.role;" parent="YPGgIuon6uP2eLTShOE7-13" vertex="1">
          <mxGeometry x="40" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-16" value="Repo 2" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" parent="YPGgIuon6uP2eLTShOE7-13" vertex="1">
          <mxGeometry x="160" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-17" value="Container Image&lt;br&gt;Tag1, 2, 3, ..." style="html=1;verticalLabelPosition=bottom;align=center;labelBackgroundColor=#ffffff;verticalAlign=top;strokeWidth=2;strokeColor=#0080F0;shadow=0;dashed=0;shape=mxgraph.ios7.icons.cube;" parent="YPGgIuon6uP2eLTShOE7-13" vertex="1">
          <mxGeometry x="280" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-18" value="App 2" style="swimlane;whiteSpace=wrap;html=1;" parent="YPGgIuon6uP2eLTShOE7-13" vertex="1">
          <mxGeometry width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-19" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-37" vertex="1" connectable="0">
          <mxGeometry y="440" width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-20" value="Job Definition&lt;br&gt;1, 2, 3, ..." style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.template;" parent="YPGgIuon6uP2eLTShOE7-19" vertex="1">
          <mxGeometry x="400" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-21" value="IAM Role" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#BF0816;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.role;" parent="YPGgIuon6uP2eLTShOE7-19" vertex="1">
          <mxGeometry x="40" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-22" value="Repo 3" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" parent="YPGgIuon6uP2eLTShOE7-19" vertex="1">
          <mxGeometry x="160" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-23" value="Container Image&lt;br&gt;Tag1, 2, 3, ..." style="html=1;verticalLabelPosition=bottom;align=center;labelBackgroundColor=#ffffff;verticalAlign=top;strokeWidth=2;strokeColor=#0080F0;shadow=0;dashed=0;shape=mxgraph.ios7.icons.cube;" parent="YPGgIuon6uP2eLTShOE7-19" vertex="1">
          <mxGeometry x="280" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-24" value="App 3" style="swimlane;whiteSpace=wrap;html=1;" parent="YPGgIuon6uP2eLTShOE7-19" vertex="1">
          <mxGeometry width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-31" value="" style="group" parent="YPGgIuon6uP2eLTShOE7-37" vertex="1" connectable="0">
          <mxGeometry y="680" width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-32" value="Job Definition&lt;br&gt;1, 2, 3, ..." style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.template;" parent="YPGgIuon6uP2eLTShOE7-31" vertex="1">
          <mxGeometry x="400" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-33" value="IAM Role" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#BF0816;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.role;" parent="YPGgIuon6uP2eLTShOE7-31" vertex="1">
          <mxGeometry x="40" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-34" value="Repo 3" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" parent="YPGgIuon6uP2eLTShOE7-31" vertex="1">
          <mxGeometry x="160" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-35" value="Container Image&lt;br&gt;Tag1, 2, 3, ..." style="html=1;verticalLabelPosition=bottom;align=center;labelBackgroundColor=#ffffff;verticalAlign=top;strokeWidth=2;strokeColor=#0080F0;shadow=0;dashed=0;shape=mxgraph.ios7.icons.cube;" parent="YPGgIuon6uP2eLTShOE7-31" vertex="1">
          <mxGeometry x="280" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-36" value="App 4" style="swimlane;whiteSpace=wrap;html=1;" parent="YPGgIuon6uP2eLTShOE7-31" vertex="1">
          <mxGeometry width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-47" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="40" y="2560" width="560" height="400" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-38" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#FF4F8B;gradientDirection=north;fillColor=#BC1356;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.step_functions;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-40" value="Lambda Function" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.lambda;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry x="240" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-41" value="SNS Notification" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#FF4F8B;gradientDirection=north;fillColor=#BC1356;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.sns;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry x="400" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-42" value="Event Bridge" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#FF4F8B;gradientDirection=north;fillColor=#BC1356;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.eventbridge;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry x="80" y="240" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-43" value="S3 Bucket" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#60A337;gradientDirection=north;fillColor=#277116;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.s3;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry x="240" y="80" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-44" value="Batch Job" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.batch;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry x="80" y="80" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-45" value="Parameter Store" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#B0084D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;pointerEvents=1;shape=mxgraph.aws4.parameter_store;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry x="400" y="80" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YPGgIuon6uP2eLTShOE7-46" value="Batch Job Orchestration" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;verticalAlign=top;" parent="YPGgIuon6uP2eLTShOE7-47" vertex="1">
          <mxGeometry width="560" height="400" as="geometry" />
        </mxCell>
        <mxCell id="odwQY8tKa5eHIlE0o-Ll-1" value="&lt;h1&gt;Batch Job Orchestration&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;div&gt;有了很多个 Job Definition 之后, 我们可以用 StepFunction, Lambda 等工具对其进行编排运行. 对计算状态进行监控, 对计算结果进行检查.&amp;nbsp;因为编排项目可能会涉及到多个 Job Definition 和其他的 Lambda 等资源, 适合单独开一个项目进行管理.&lt;/div&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=default;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="2320" width="560" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
